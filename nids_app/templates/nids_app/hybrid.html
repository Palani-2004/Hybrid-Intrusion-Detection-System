{% extends 'nids_app/base.html' %}
{% load static %}
{% block title %}Hybrid Detection{% endblock %}

{% block content %}
<div class="card">
  <h2>Hybrid detection</h2>

  <p id="narrative" class="muted"></p>

  <p class="muted" style="margin-top:-6px">
    Pipeline stage:
    <strong>Upload → Preprocess → Train → Predict → Hybrid</strong>
  </p>

  <p class="muted">
    Hybrid detection fuses machine learning predictions with
    rule-based intrusion signatures.
  </p>

  <p class="muted">
    This stage improves reliability by validating statistical predictions
    against known attack patterns.
  </p>

  <p class="muted">
    The result is a final, high-confidence intrusion decision.
  </p>

  <!-- EDUCATIONAL EXPLANATION BLOCK -->
  <div class="explain-block">
    <h2>Hybrid Intrusion Detection System Overview</h2>

    <img src="{% static 'images/ids-visual.png' %}"
         class="ids-visual"
         alt="Hybrid IDS Visualization">

    <p class="muted">
      Our Hybrid IDS combines machine learning–based anomaly detection
      with signature-based rule enforcement to accurately classify
      malicious and benign network traffic.
    </p>

    <p class="muted">
      Machine learning models identify deviations from normal behavior,
      while signature rules validate alerts against known attack vectors,
      significantly reducing false positives.
    </p>
  </div>

  <div style="margin-top:12px">
    <form method="post" style="display:inline-block">
      {% csrf_token %}
      <button class="btn">Run now (blocking)</button>
    </form>

    <button id="run-bg" class="btn" style="margin-left:8px">
      Run in background (live)
    </button>

    <a href="{% url 'download_hybrid' %}" class="btn" style="margin-left:8px">
      Download last result
    </a>
  </div>

  {% if output %}
    <pre class="log" style="margin-top:16px">{{ output }}</pre>
  {% endif %}

  {% if success %}
    <a href="{% url 'dashboard' %}" class="btn btn-next">
      Proceed to Dashboard →
    </a>
  {% endif %}
</div>

<script>
{% if success %}
typeWriter(
  "narrative",
  "Hybrid detection complete. Final intrusion decisions generated by combining ML and signature analysis."
);
{% else %}
typeWriter(
  "narrative",
  "Hybrid detection ready. Machine learning output will now be reinforced using signature rules."
);
{% endif %}
</script>
{% endblock %}
